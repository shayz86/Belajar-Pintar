<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calistung Master - Belajar & Bermain</title>
    <!-- Tailwind CSS untuk styling cepat -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font ramah anak: Fredoka -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Kustom Tambahan */
        body {
            font-family: 'Fredoka', sans-serif;
            background: #e0f2fe; /* Biru Muda lembut */
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent; /* Hilangkan highlight tap di mobile */
            user-select: none; /* Mencegah seleksi teks */
        }

        /* Gaya Tombol 3D 'Empuk' */
        .btn-3d {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            top: 0;
            box-shadow: 0 6px 0 rgba(0,0,0,0.15); /* Bayangan bawah */
        }
        .btn-3d:active {
            top: 4px; /* Efek ditekan */
            box-shadow: 0 2px 0 rgba(0,0,0,0.15);
        }

        /* Animasi Melayang (Floating) */
        .floating { animation: float 3s ease-in-out infinite; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        /* Animasi Muncul (Pop In) */
        .pop-in { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Animasi Salah (Shake) */
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Manajemen Layar */
        .screen { display: none; min-height: 100vh; width: 100%; }
        .screen.active { display: flex; flex-direction: column; }
        
        /* Tampilan Suku Kata */
        .syllable-part {
            display: inline-block;
            padding: 0 5px;
            margin: 0 2px;
            border-bottom: 4px solid #cbd5e1;
        }
    </style>
</head>
<body class="bg-blue-50">

    <!-- 1. HALAMAN BERANDA -->
    <section id="home" class="screen active items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <div class="text-center mb-8 pop-in">
            <div class="text-8xl mb-4 floating"></div>
            <h1 class="text-5xl font-bold text-blue-600 mb-2 drop-shadow-sm">CALISTUNG</h1>
            <h2 class="text-2xl font-semibold text-blue-400 bg-white inline-block px-4 py-1 rounded-full shadow-sm">Master Membaca</h2>
        </div>
        
        <div class="grid grid-cols-1 gap-4 w-full max-w-sm">
            <button onclick="nav('alphabet')" class="btn-3d w-full bg-yellow-400 hover:bg-yellow-300 text-white p-5 rounded-3xl text-xl font-bold flex items-center justify-between px-6 border-b-4 border-yellow-500">
                <span class="text-3xl"></span> <span>KENAL HURUF</span> <span></span>
            </button>
            
            <button onclick="nav('syllable-select')" class="btn-3d w-full bg-green-500 hover:bg-green-400 text-white p-5 rounded-3xl text-xl font-bold flex items-center justify-between px-6 border-b-4 border-green-600">
                <span class="text-3xl"></span> <span>SUKU KATA</span> <span></span>
            </button>
            
            <button onclick="nav('reading-intro')" class="btn-3d w-full bg-pink-500 hover:bg-pink-400 text-white p-5 rounded-3xl text-xl font-bold flex items-center justify-between px-6 border-b-4 border-pink-600">
                <span class="text-3xl"></span> <span>BACA KATA</span> <span></span>
            </button>
            
            <button onclick="startGameMode()" class="btn-3d w-full bg-purple-600 hover:bg-purple-500 text-white p-5 rounded-3xl text-xl font-bold flex items-center justify-between px-6 border-b-4 border-purple-800 mt-4 relative overflow-hidden group">
                <div class="absolute inset-0 bg-white opacity-10 group-hover:opacity-20 transition"></div>
                <span class="text-3xl"></span> <span>MINI GAME</span> <span></span>
            </button>
        </div>
    </section>

    <!-- 2. HALAMAN KENAL HURUF -->
    <section id="alphabet" class="screen p-4 bg-yellow-50">
        <div class="sticky top-0 z-20 flex items-center justify-between bg-yellow-50/95 backdrop-blur py-3 mb-4 border-b border-yellow-100">
            <button onclick="nav('home')" class="bg-white p-3 rounded-xl shadow text-xl active:scale-95"></button>
            <h2 class="text-2xl font-bold text-yellow-600">Alfabet A-Z</h2>
            <div class="w-10"></div>
        </div>
        <div id="grid-alphabet" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 pb-20 max-w-4xl mx-auto">
            <!-- Diisi oleh JavaScript -->
        </div>
    </section>

    <!-- 3. HALAMAN PILIH SUKU KATA -->
    <section id="syllable-select" class="screen p-4 bg-green-50">
        <div class="sticky top-0 z-20 flex items-center justify-between bg-green-50/95 backdrop-blur py-3 mb-4 border-b border-green-100">
            <button onclick="nav('home')" class="bg-white p-3 rounded-xl shadow text-xl active:scale-95"></button>
            <h2 class="text-2xl font-bold text-green-600">Pilih Huruf</h2>
            <div class="w-10"></div>
        </div>
        <div id="grid-syllable-letters" class="grid grid-cols-4 sm:grid-cols-5 gap-3 pb-20 max-w-3xl mx-auto">
            <!-- Diisi oleh JavaScript -->
        </div>
    </section>

    <!-- 4. HALAMAN MAIN SUKU KATA -->
    <section id="syllable-play" class="screen items-center justify-center p-6 bg-green-100">
        <div class="w-full max-w-md bg-white rounded-[40px] p-8 text-center shadow-2xl relative pop-in border-4 border-green-200">
            <button onclick="nav('syllable-select')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 text-2xl"></button>
            <div class="mb-2 text-sm font-bold text-green-400 tracking-widest mt-4">LATIHAN SUKU KATA</div>
            <div id="syl-icon" class="text-9xl mb-6 floating block mt-4"></div>
            <div id="syl-text" class="flex justify-center gap-2 text-5xl font-bold text-gray-700 mb-8 uppercase flex-wrap"></div>
            <div class="space-y-4">
                <button onclick="speakSyllable()" class="w-full bg-blue-100 text-blue-600 font-bold py-4 rounded-2xl flex items-center justify-center gap-2 hover:bg-blue-200 transition text-xl"> Dengar</button>
                <button onclick="nextSyllable()" class="btn-3d w-full bg-green-500 text-white font-bold py-4 rounded-2xl text-2xl shadow-green-700/50">Lanjut </button>
            </div>
            <div class="mt-6 flex justify-center gap-2" id="syl-dots"></div>
        </div>
    </section>

    <!-- 5. HALAMAN BACA KATA (INTRO) -->
    <section id="reading-intro" class="screen items-center justify-center p-6 bg-pink-100">
        <div class="text-center max-w-md pop-in">
            <div class="text-8xl mb-4"></div>
            <h2 class="text-4xl font-bold text-pink-600 mb-4">Fokus Baca Tulisan</h2>
            <p class="text-lg text-gray-600 mb-8">Disini tidak ada gambar. Kamu harus membaca tulisannya sendiri ya!</p>
            <button onclick="startReadingMode()" class="btn-3d bg-pink-500 text-white px-10 py-4 rounded-full text-2xl font-bold shadow-pink-700/50">Mulai Baca</button>
            <button onclick="nav('home')" class="block mt-6 text-gray-500 font-bold underline">Kembali</button>
        </div>
    </section>

    <!-- 6. HALAMAN BACA KATA (MAIN) -->
    <section id="reading-play" class="screen items-center justify-center p-6 bg-white relative">
        <button onclick="nav('reading-intro')" class="absolute top-6 left-6 p-3 bg-gray-100 rounded-2xl text-gray-500 hover:bg-gray-200 font-bold shadow-md z-10 flex items-center gap-2">
            <span></span> <span class="hidden sm:inline">Keluar</span>
        </button>

        <div class="w-full max-w-2xl text-center mt-10">
            <div class="mb-4 text-gray-400 font-bold uppercase tracking-widest">Tantangan Membaca</div>
            <div id="read-word" class="text-7xl sm:text-9xl font-black text-gray-800 tracking-wider mb-16 uppercase transition-all duration-300 transform">BOLA</div>
            
            <div class="grid gap-4 max-w-sm mx-auto">
                <button onclick="checkRead()" class="btn-3d bg-pink-500 text-white py-6 rounded-3xl font-bold text-2xl shadow-pink-700/50">AKU BISA BACA! </button>
                <button onclick="speakReadWord()" class="text-pink-400 font-bold text-sm bg-pink-50 py-2 rounded-xl"> Bantuan Suara</button>
            </div>
            <div class="mt-12 flex justify-center gap-2" id="read-dots"></div>
        </div>
    </section>

    <!-- 7. HALAMAN MINI GAME (50 SOAL BANK) -->
    <section id="game-play" class="screen items-center justify-center p-4 bg-purple-600">
        <div class="w-full max-w-md bg-white rounded-[30px] p-6 shadow-2xl relative pop-in">
            <div class="flex justify-between items-center mb-6 bg-purple-50 p-3 rounded-2xl">
                <button onclick="nav('home')" class="text-purple-400 font-bold text-sm"> Keluar</button>
                <div class="text-right">
                    <div class="font-bold text-purple-800">Skor: <span id="game-score">0</span></div>
                    <div class="text-xs text-purple-400 font-bold mt-1">Soal <span id="game-progress">1</span>/10</div>
                </div>
            </div>

            <div class="text-center mb-8">
                <h3 class="text-gray-500 font-bold text-sm mb-2">Tebak Kata untuk gambar ini:</h3>
                <div id="game-question-icon" class="text-9xl floating inline-block"></div>
            </div>

            <div id="game-options" class="grid gap-3"></div>
            <div id="game-feedback" class="h-8 mt-4 text-center font-bold text-transparent">...</div>
        </div>
    </section>

    <!-- OVERLAY CONGRATS (Menang) -->
    <div id="overlay-congrats" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center hidden backdrop-blur-sm">
        <div class="bg-white p-8 rounded-[40px] text-center max-w-sm mx-4 pop-in border-8 border-yellow-400">
            <div class="text-8xl mb-4 animate-bounce"></div>
            <h2 class="text-4xl font-bold text-yellow-500 mb-2">HEBAT!</h2>
            <p id="congrats-msg" class="text-gray-500 font-bold text-lg mb-8">Kamu menyelesaikan sesi ini!</p>
            <button onclick="closeCongrats()" class="btn-3d bg-blue-500 text-white py-4 px-10 rounded-full font-bold text-xl w-full">Main Lagi</button>
        </div>
    </div>

    <script>
        /* ================= DATA BANK ================= */
        const alphabetData = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('').map(char => {
            const examples = {
                'A':['Ayam',''], 'B':['Bola',''], 'C':['Ceri',''], 'D':['Dadu',''],
                'E':['Es',''], 'F':['Foto',''], 'G':['Gajah',''], 'H':['Hiu',''],
                'I':['Ikan',''], 'J':['Jus',''], 'K':['Kuda',''], 'L':['Lemon',''],
                'M':['Mobil',''], 'N':['Nanas',''], 'O':['Obor',''], 'P':['Panda',''],
                'Q':['Quran',''], 'R':['Roti',''], 'S':['Sapi',''], 'T':['Topi',''],
                'U':['Ular',''], 'V':['Vas',''], 'W':['Wortel',''], 'X':['Xilofon',''],
                'Y':['Yoyo',''], 'Z':['Zebra','']
            };
            return { char, word: examples[char][0], icon: examples[char][1] };
        });

        // BANK 50 SOAL MINI GAME
        const miniGameBank = [
            {w:"AYAM", i:""}, {w:"BOLA", i:""}, {w:"KUCING", i:""}, {w:"IKAN", i:""}, {w:"GAJAH", i:""},
            {w:"RUMAH", i:""}, {w:"MOBIL", i:""}, {w:"BUKU", i:""}, {w:"PENSIL", i:""}, {w:"POHON", i:""},
            {w:"BUNGA", i:""}, {w:"MATAHARI", i:""}, {w:"BULAN", i:""}, {w:"BINTANG", i:""}, {w:"PELANGI", i:""},
            {w:"API", i:""}, {w:"AIR", i:""}, {w:"ES", i:""}, {w:"ROTI", i:""}, {w:"SUSU", i:""},
            {w:"KEJU", i:""}, {w:"TELUR", i:""}, {w:"PIZZA", i:""}, {w:"BURGER", i:""}, {w:"DONAT", i:""},
            {w:"APEL", i:""}, {w:"PISANG", i:""}, {w:"ANGGUR", i:""}, {w:"JERUK", i:""}, {w:"NANAS", i:""},
            {w:"TOPI", i:""}, {w:"BAJU", i:""}, {w:"CELANA", i:""}, {w:"SEPATU", i:""}, {w:"KACAMATA", i:""},
            {w:"JAM", i:""}, {w:"TAS", i:""}, {w:"PAYUNG", i:""}, {w:"KUNCI", i:""}, {w:"GUNTING", i:""},
            {w:"GITAR", i:""}, {w:"DRUM", i:""}, {w:"BOLA BASKET", i:""}, {w:"SEPEDA", i:""}, {w:"PESAWAT", i:""},
            {w:"KERETA", i:""}, {w:"PERAHU", i:""}, {w:"ROKET", i:""}, {w:"ROBOT", i:""}, {w:"BONEKA", i:""}
        ];

        // BANK SUKU KATA DIPERBARUI (Fokus 4 Huruf, Ejaan Diperbaiki)
        const syllableBank = {
            'B': [
                ['BA-JU',''], ['BO-LA',''], ['BU-KU',''], ['BI-RU',''], ['BA-TU',''], 
                ['BA-CA',''], ['BA-WA',''], ['BO-LU',''], ['BI-BI',''], ['BA-YI',''],
                ['BA-HU',''], ['BA-TA',''], ['BU-SA',''], ['BI-JI',''], ['BU-TA',''],
                ['BE-DA',''], ['BO-BI',''], ['BA-KI',''], ['BA-LI',''], ['BA-RU','']
            ],
            'C': [
                ['CA-BE',''], ['CU-CI',''], ['CE-RI',''], ['CA-RA',''], ['CU-KA',''],
                ['CI-NA',''], ['CU-MA','1'], ['CA-RI',''], ['CI-TA',''], ['CI-UM',''],
                ['CU-TI',''], ['CA-KU',''], ['CO-BA',''], ['CA-AT',''], ['CI-RI',''],
                ['CU-MI',''], ['CI-KA',''], ['CI-CAK',''], ['CA-KAR',''], ['CE-PAT','']
            ],
            'D': [
                ['DA-DU',''], ['DU-A','2'], ['DO-NAT',''], ['DA-UN',''], ['DU-RI',''],
                ['DE-SA',''], ['DA-GU',''], ['DA-HI',''], ['DA-NA',''], ['DA-SI',''],
                ['DO-I',''], ['DU-KU',''], ['DE-BU',''], ['DI-RI',''], ['DA-YA',''],
                ['DO-A',''], ['DO-SA',''], ['DU-NIA',''], ['DI-A',''], ['DA-RA','']
            ],
            'F': [
                ['FO-TO',''], ['FE-RI',''], ['FA-JAR',''], ['FO-KUS',''], ['FI-SIK',''],
                ['FA-SE',''], ['FU-JI',''], ['FA-KIR',''], ['FE-TA',''], ['FI-NI',''],
                ['FA-HAM',''], ['FO-YER',''], ['FA-UNA',''], ['FLO-RA',''], ['FRE-ON','']
            ],
            'G': [
                ['GI-GI',''], ['GU-LA',''], ['GU-RU',''], ['GA-UN',''], ['GU-CI',''],
                ['GA-YA',''], ['GE-MA',''], ['GO-A',''], ['GU-SI',''], ['GA-JI',''],
                ['GI-ZI',''], ['GA-RA',''], ['GU-NA',''], ['GO-JEK',''], ['GE-RA',''],
                ['GA-JAH',''], ['GA-LAK',''], ['GO-SOK',''], ['GU-BUK',''], ['GE-RAS','']
            ],
            'H': [
                ['HA-TI',''], ['HA-RI',''], ['HA-WA',''], ['HU-LU',''], ['HI-NA',''],
                ['HO-BI',''], ['HA-LO',''], ['HU-NI',''], ['HI-U',''], ['HA-JI',''],
                ['HU-TAN',''], ['HI-TAM',''], ['HI-JAU',''], ['HU-JAN',''], ['HA-BIS',''],
                ['HA-PUS',''], ['HE-WAN',''], ['HA-US',''], ['HA-DIR',''], ['HA-RIMAU','']
            ],
            'J': [
                ['JA-RI',''], ['JA-HE',''], ['JA-LA',''], ['JI-WA',''], ['JU-GA',''],
                ['JU-TA',''], ['JA-MU',''], ['JA-WA',''], ['JU-LI',''], ['JU-NI',''],
                ['JA-LAN',''], ['JAM-BU',''], ['JUS',''], ['JE-RUK',''], ['JA-GUNG',''],
                ['JA-RUM',''], ['JA-UH',''], ['JE-LAS',''], ['JA-UH',''], ['JE-RA-PAH','']
            ],
            'K': [
                ['KA-KI',''], ['KU-DA',''], ['KO-PI',''], ['KA-CA',''], ['KE-JU',''],
                ['KU-KU',''], ['KA-YA',''], ['KO-KO',''], ['KI-NI',''], ['KA-MU',''],
                ['KI-TA',''], ['KO-TA',''], ['KA-TA',''], ['KU-PU',''], ['KA-YU',''],
                ['KO-LAM',''], ['KA-PAL',''], ['KA-SUR',''], ['KA-MIS',''], ['KE-LAS','']
            ],
            'L': [
                ['LA-RI',''], ['LI-MA','5'], ['LA-BU',''], ['LU-KA',''], ['LA-UT',''],
                ['LU-PA',''], ['LA-GI',''], ['LA-MA',''], ['LI-DI',''], ['LE-LE',''],
                ['LO-BI',''], ['LU-LU',''], ['LAM-PU',''], ['LE-HER',''], ['LI-BUR',''],
                ['LU-RUS',''], ['LA-PAR',''], ['LI-HAT',''], ['LE-BAT',''], ['LE-MAH','']
            ],
            'M': [
                ['MA-TA',''], ['ME-JA',''], ['MA-DU',''], ['MA-MA',''], ['MA-LU',''],
                ['MU-KA',''], ['MU-DA',''], ['MA-KAN',''], ['MA-LAM',''], ['MA-WAR',''],
                ['MA-LAS',''], ['MU-LUT',''], ['MA-SUK',''], ['MI-NUM',''], ['ME-RAH',''],
                ['MA-NIS',''], ['MO-BIL',''], ['MU-RAH',''], ['MA-SAK',''], ['MU-SIM','']
            ],
            'N': [
                ['NA-SI',''], ['NA-MA',''], ['NI-LA',''], ['NA-DI',''], ['NA-GA',''],
                ['NO-TA',''], ['NA-IK',''], ['NO-NA',''], ['NI-LAI',''], ['NA-FAS',''],
                ['NA-KAL',''], ['NE-NEK',''], ['NYA-MUK',''], ['NO-MOR',''], ['NA-NAS',''],
                ['NA-TAL',''], ['NI-PIS',''], ['NYA-NYI',''], ['NYA-LA',''], ['NYA-TA','']
            ],
            'P': [
                ['PA-LU',''], ['PI-PI',''], ['PA-KU',''], ['PA-GI',''], ['PA-PA',''],
                ['PI-TA',''], ['PO-LA',''], ['PU-JI',''], ['PA-RU',''], ['PA-SAR',''],
                ['PA-GAR',''], ['PA-HIT',''], ['PA-NAS',''], ['PU-TIH',''], ['PI-NTU',''],
                ['PO-HON',''], ['PI-SANG',''], ['PA-SIR',''], ['PA-YUNG',''], ['PE-DAS','']
            ],
            'Q': [
                ['QA-RI',''], ['QU-RAN',''], ['QA-SAR',''], ['QI-SAS','']
            ],
            'R': [
                ['RO-TI',''], ['RO-DA',''], ['RA-JA',''], ['RA-TU',''], ['RA-GU',''],
                ['RA-YA',''], ['RI-BU',''], ['RA-PI',''], ['RA-K',''], ['RA-JIN',''],
                ['RU-MAH',''], ['RU-SA',''], ['RO-BOT',''], ['RA-MPUT',''], ['RA-ASA',''],
                ['RU-WET',''], ['RU-SAK',''], ['RA-JUN',''], ['RA-WAT',''], ['RA-MAI','']
            ],
            'S': [
                ['SA-PI',''], ['SU-SU',''], ['SA-PU',''], ['SA-TU','1'], ['SA-YA',''],
                ['SU-KA',''], ['SO-TO',''], ['SO-FA',''], ['SI-KU',''], ['SA-TE',''],
                ['SE-PI',''], ['SA-KU',''], ['SA-KIT',''], ['SE-PATU',''], ['SA-YUR',''],
                ['SI-KAT',''], ['SE-MUT',''], ['SU-RAT',''], ['SI-ANG',''], ['SA-BUN','']
            ],
            'T': [
                ['TO-PI',''], ['TA-LI',''], ['TA-HU',''], ['TI-GA','3'], ['TI-SU',''],
                ['TO-KO',''], ['TA-MU',''], ['TA-RI',''], ['TU-GU',''], ['TU-JU',''],
                ['TI-PU',''], ['TAS',''], ['TE-LOR',''], ['TI-DUR',''], ['TA-NAM',''],
                ['TE-MAN',''], ['TA-KUT',''], ['TA-HUN',''], ['TU-JUH','7'], ['TI-KUS','']
            ],
            'V': [
                ['VI-LA',''], ['VO-LI',''], ['VAS',''], ['VI-SI',''], ['VE-TO',''],
                ['VA-KUM',''], ['VI-RUS',''], ['VA-RIA','']
            ],
            'W': [
                ['WA-JAH',''], ['WA-TU',''], ['WA-NI',''], ['WA-JA',''], ['WA-YANG',''],
                ['WA-JAN',''], ['WAR-NA',''], ['WOR-TEL',''], ['WA-KIL',''], ['WA-JIB',''],
                ['WA-KTU',''], ['WA-RUNG',''], ['WA-RGA','']
            ],
            'X': [
                ['X-RAY',''], ['XI-LO-FON','']
            ],
            'Y': [
                ['YO-YO',''], ['YA-KIN',''], ['YE-NI',''], ['YU-YU',''], ['YE-S',''],
                ['YA-TIM',''], ['YU-NAN','']
            ],
            'Z': [
                ['ZE-BRA',''], ['ZO-NA',''], ['ZAM-RUD',''], ['ZA-KAT',''], ['ZA-ITUN',''],
                ['ZE-RO','0'], ['ZO-OM',''], ['ZA-MAN','']
            ]
        };

        // BANK BACA KATA (Fokus 10 dari Bank ini)
        const readingWords = [
            "BOLA", "MAMA", "PAPA", "BUKU", "SAPI", "KACA", "LARI", "GIGI", "KAKI", 
            "MEJA", "BATU", "JARI", "MATA", "SUSU", "ROTI", "SAYA", "SUKA", "BACA"
        ];

        /* ================= STATE ================= */
        let activeSyllables = [];
        let activeSylIndex = 0;
        
        let activeReading = [];
        let activeReadIndex = 0;

        let gameScore = 0;
        let activeGameQueue = []; // Antrian 10 soal
        let activeGameIndex = 0;
        let activeGameQuestion = null;
        let isGameLocked = false;

        /* ================= NAVIGASI ================= */
        function nav(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0,0);

            if(screenId === 'alphabet') renderAlphabet();
            if(screenId === 'syllable-select') renderSyllableSelect();
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text.replace(/-/g, ''));
            u.lang = 'id-ID';
            u.rate = 0.9;
            window.speechSynthesis.speak(u);
        }

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        /* ================= 2. ALFABET ================= */
        function renderAlphabet() {
            const grid = document.getElementById('grid-alphabet');
            grid.innerHTML = '';
            alphabetData.forEach(item => {
                const btn = document.createElement('button');
                btn.className = "btn-3d bg-white border border-yellow-200 rounded-2xl p-6 flex flex-col items-center justify-center hover:bg-yellow-50 min-h-[160px]";
                btn.onclick = () => speak(`${item.char}... ${item.word}`);
                btn.innerHTML = `
                    <span class="text-6xl mb-2">${item.icon}</span>
                    <span class="text-6xl font-black text-yellow-500 font-sans">${item.char}</span>
                    <span class="text-sm font-bold text-gray-400 mt-2 uppercase tracking-widest">${item.word}</span>
                `;
                grid.appendChild(btn);
            });
        }

        /* ================= 3 & 4. SUKU KATA ================= */
        function renderSyllableSelect() {
            const grid = document.getElementById('grid-syllable-letters');
            grid.innerHTML = '';
            Object.keys(syllableBank).sort().forEach(char => {
                const btn = document.createElement('button');
                btn.className = "btn-3d bg-white border-b-4 border-green-200 rounded-2xl p-4 text-4xl font-bold text-green-600 hover:bg-green-50 aspect-square";
                btn.innerText = char;
                btn.onclick = () => startSyllableSession(char);
                grid.appendChild(btn);
            });
        }

        function startSyllableSession(char) {
            const allWords = syllableBank[char];
            const shuffled = shuffle([...allWords]);
            activeSyllables = shuffled.slice(0, 3);
            activeSylIndex = 0;
            nav('syllable-play');
            renderSyllableCard();
        }

        function renderSyllableCard() {
            const current = activeSyllables[activeSylIndex];
            document.getElementById('syl-icon').innerText = current[1];
            
            const textContainer = document.getElementById('syl-text');
            textContainer.innerHTML = '';
            
            // Cek jika kata mengandung pemisah suku kata (-)
            if(current[0].includes('-')) {
                const parts = current[0].split('-');
                parts.forEach(p => {
                    const span = document.createElement('span');
                    span.className = "syllable-part border-green-300";
                    span.innerText = p;
                    textContainer.appendChild(span);
                });
            } else {
                // Untuk kata satu suku kata (TAS, JUS, dll)
                const span = document.createElement('span');
                span.className = "syllable-part border-green-300";
                span.innerText = current[0];
                textContainer.appendChild(span);
            }

            const dots = document.getElementById('syl-dots');
            dots.innerHTML = '';
            activeSyllables.forEach((_, i) => {
                const d = document.createElement('div');
                d.className = `h-3 w-3 rounded-full ${i === activeSylIndex ? 'bg-green-500' : 'bg-green-200'}`;
                dots.appendChild(d);
            });
        }

        function speakSyllable() {
            speak(activeSyllables[activeSylIndex][0]);
        }

        function nextSyllable() {
            if (activeSylIndex < activeSyllables.length - 1) {
                activeSylIndex++;
                renderSyllableCard();
            } else {
                showCongrats("Latihan Suku Kata Selesai!");
            }
        }

        /* ================= 5 & 6. BACA KATA ================= */
        function startReadingMode() {
            activeReading = shuffle([...readingWords]).slice(0, 10); 
            activeReadIndex = 0;
            nav('reading-play');
            renderReadingCard();
        }

        function renderReadingCard() {
            const word = activeReading[activeReadIndex];
            const el = document.getElementById('read-word');
            el.style.opacity = 0;
            el.style.transform = 'scale(0.8)';
            setTimeout(() => {
                el.innerText = word;
                el.style.opacity = 1;
                el.style.transform = 'scale(1)';
            }, 200);

            const dots = document.getElementById('read-dots');
            dots.innerHTML = '';
            activeReading.forEach((_, i) => {
                const d = document.createElement('div');
                d.className = `h-3 w-3 rounded-full ${i <= activeReadIndex ? 'bg-pink-500' : 'bg-pink-200'}`;
                dots.appendChild(d);
            });
        }

        function speakReadWord() {
            speak(activeReading[activeReadIndex]);
        }

        function checkRead() {
            if (activeReadIndex < activeReading.length - 1) {
                activeReadIndex++;
                speak("Bagus!");
                renderReadingCard();
            } else {
                showCongrats("Kamu Jago Membaca!");
            }
        }

        /* ================= 7. MINI GAME (50 BANK, 10 PER SESSION) ================= */
        function startGameMode() {
            gameScore = 0;
            // 1. Acak Bank 50 soal
            const shuffledBank = shuffle([...miniGameBank]);
            // 2. Ambil 10 soal saja untuk sesi ini
            activeGameQueue = shuffledBank.slice(0, 10);
            activeGameIndex = 0;
            
            document.getElementById('game-score').innerText = gameScore;
            nav('game-play');
            renderGameLevel();
        }

        function renderGameLevel() {
            isGameLocked = false;
            
            // Perbarui indikator soal (Contoh: Soal 1/10)
            document.getElementById('game-progress').innerText = activeGameIndex + 1;

            const correctData = activeGameQueue[activeGameIndex];
            activeGameQuestion = correctData;

            // Buat Pengecoh (Distractor) dari sisa bank (tidak termasuk jawaban benar)
            let distractors = miniGameBank
                .filter(d => d.w !== correctData.w)
                .sort(() => 0.5 - Math.random())
                .slice(0, 2);

            let options = shuffle([correctData, ...distractors]);

            document.getElementById('game-question-icon').innerText = correctData.i;
            document.getElementById('game-feedback').innerText = "";
            
            const btnContainer = document.getElementById('game-options');
            btnContainer.innerHTML = '';

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-3d w-full bg-white border-2 border-purple-100 text-purple-700 font-bold py-4 rounded-2xl text-xl hover:bg-purple-50 transition";
                btn.innerText = opt.w;
                btn.onclick = function() { checkGameAnswer(opt.w, this); };
                btnContainer.appendChild(btn);
            });
        }

        function checkGameAnswer(selectedWord, btnElement) {
            if (isGameLocked) return;

            if (selectedWord === activeGameQuestion.w) {
                // BENAR
                isGameLocked = true;
                gameScore += 10;
                document.getElementById('game-score').innerText = gameScore;
                
                btnElement.classList.remove('bg-white', 'text-purple-700', 'hover:bg-purple-50');
                btnElement.classList.add('bg-green-500', 'text-white', 'border-green-600');
                speak("Benar!");
                
                setTimeout(() => {
                    if (activeGameIndex < 9) { // 0-9 (Total 10 soal)
                        activeGameIndex++;
                        renderGameLevel();
                    } else {
                        showCongrats("Game Selesai! Skor: " + gameScore);
                    }
                }, 1000);
            } else {
                // SALAH
                btnElement.classList.add('bg-red-500', 'text-white', 'shake');
                speak("Coba lagi");
                setTimeout(() => {
                    btnElement.classList.remove('shake', 'bg-red-500', 'text-white');
                    btnElement.classList.add('bg-white', 'text-purple-700');
                }, 500);
            }
        }

        /* ================= UMUM ================= */
        function showCongrats(msg) {
            document.getElementById('congrats-msg').innerText = msg;
            document.getElementById('overlay-congrats').classList.remove('hidden');
            document.getElementById('overlay-congrats').classList.add('flex');
            speak("Luar biasa! Kamu berhasil.");
        }

        function closeCongrats() {
            document.getElementById('overlay-congrats').classList.add('hidden');
            document.getElementById('overlay-congrats').classList.remove('flex');
            nav('home');
        }
    </script>
</body>
</html>

